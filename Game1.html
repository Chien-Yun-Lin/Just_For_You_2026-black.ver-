<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Core_System_v3.26</title>
    <style>
        :root { --main-green: #00ff41; --danger: #ff3131; --vcore: #00d4ff; --final-pink: #ff00ff; }
        body { background: #050505; color: var(--main-green); font-family: 'Courier New', monospace; display: flex; flex-direction: column; align-items: center; padding: 10px; margin: 0; touch-action: manipulation; }
        
        #game-container { border: 2px solid var(--main-green); width: 95%; max-width: 400px; padding: 15px; border-radius: 5px; box-shadow: 0 0 20px rgba(0, 255, 65, 0.2); margin-top: 10px; box-sizing: border-box; }
        
        .bar-label { font-size: 11px; margin-top: 10px; color: #aaa; display: flex; justify-content: space-between; }
        .bar-container { background: #111; border: 1px solid var(--main-green); height: 14px; width: 100%; margin: 4px 0; overflow: hidden; }
        #hp-bar { background: var(--danger); width: 100%; height: 100%; transition: width 0.3s; }
        #mp-bar { background: var(--vcore); width: 100%; height: 100%; transition: 0.3s; }

        #screen { height: 100px; background: #000; padding: 10px; font-size: 11px; border: 1px inset var(--main-green); margin: 10px 0; line-height: 1.4; color: var(--main-green); overflow-y: auto; scroll-behavior: smooth; }
        
        #oscilloscope { height: 150px; width: 100%; background: #001a00; position: relative; border: 1px solid #004400; margin-bottom: 10px; display: none; }
        canvas { width: 100%; height: 100%; display: block; }

        .menu { display: grid; grid-template-columns: 1fr 1fr; gap: 6px; }
        button { background: #000; border: 1px solid var(--main-green); color: var(--main-green); padding: 10px 2px; cursor: pointer; font-family: 'Courier New', monospace; font-size: 10px; font-weight: bold; transition: 0.1s; }
        button:active { background: var(--main-green); color: #000; }
        button:disabled { border-color: #333 !important; color: #444 !important; cursor: not-allowed; }
        .span-2 { grid-column: span 2; }

        .slider-box { margin: 10px 0; display: none; text-align: left; border: 1px dashed #444; padding: 10px; background: rgba(0,255,65,0.05); }
        input[type=range] { width: 100%; height: 35px; accent-color: var(--main-green); margin: 5px 0; cursor: pointer; }

        #final-screen { text-align: center; color: #fff; padding: 20px; display: none; border: 1px solid var(--final-pink); background: rgba(255, 0, 255, 0.05); border-radius: 10px; }
        .glitch { font-size: 28px; font-weight: bold; color: var(--final-pink); text-shadow: 2px 2px #00ffff, -2px -2px var(--final-pink); animation: glitch-anim 0.2s infinite alternate; }
        @keyframes glitch-anim {
            0% { transform: skewX(0deg); opacity: 1; }
            20% { transform: skewX(-5deg); opacity: 0.8; }
            40% { transform: skewX(5deg); text-shadow: -2px 0 var(--final-pink), 2px 0 #00ffff; }
            100% { transform: skewX(0deg); opacity: 1; }
        }
        .heart-glow { animation: heart-beat 1.2s infinite; color: var(--danger); font-size: 20px; display: inline-block; }
        @keyframes heart-beat {
            0%, 100% { transform: scale(1); filter: drop-shadow(0 0 5px var(--danger)); }
            50% { transform: scale(1.2); filter: drop-shadow(0 0 15px var(--danger)); }
        }
    </style>
</head>
<body>

<div id="game-container">
    <div style="text-align:center; font-size: 9px; letter-spacing: 2px; color: #008822;">[ EE_PRECISION_v3.26_FINAL ]</div>
    
    <div class="bar-label"><span>Phase Noise Level</span><span id="hp-text">100%</span></div>
    <div class="bar-container"><div id="hp-bar"></div></div>
    
    <div id="screen">> [System Initializing...]<br>> WARNING: PLL_UNLOCKED. Phase Noise éé«˜ã€‚</div>

    <div id="oscilloscope">
        <canvas id="scopeCanvas" width="400" height="150"></canvas>
        <div id="match-pct" style="position:absolute; bottom:5px; right:8px; color:var(--final-pink); font-size:10px; font-weight:bold;">PHASE: NO_LOCK</div>
    </div>

    <div class="bar-label"><span>Vcore Rails (ç©©å®šåº¦)</span><span id="mp-text">100/100</span></div>
    <div class="bar-container"><div id="mp-bar"></div></div>

    <div id="ctrl-box" class="slider-box">
        <div style="font-size:10px; color:#3498db;">Ref Divider Ratio (5.01): <span id="val1">1.00</span></div>
        <input type="range" id="freq1" min="0" max="10" step="0.01" value="1.00">
        <div style="font-size:10px; color:#2ecc71; margin-top:8px;">Feedback Divider Ratio (3.26): <span id="val2">1.00</span></div>
        <input type="range" id="freq2" min="0" max="10" step="0.01" value="1.00">
    </div>

    <div id="menu" class="menu">
        <button onclick="action('kalman')">Loop Filter Tuning</button>
        <button id="btn-reset" onclick="action('reset')">Hard Reset (<span id="r-cnt">2</span>)</button>
        <button onclick="action('recap')">Recap (Rail Stabilization)</button>
        <button onclick="action('overclock')">Overclock</button>
        <button id="btn-sync" class="span-2" onclick="startSync()" disabled>ç­‰å¾…ç³»çµ±å†·å» (Cooldown)...</button>
        <button id="btn-final" class="span-2" style="display:none;" onclick="summon()">Summon Protocol</button>
    </div>

    <div id="final-screen">
        <div class="glitch">PHASE LOCKED</div>
        <div style="margin: 15px 0;">
            <span class="heart-glow">â¤</span> 
            <span style="color: #00ffff; font-weight: bold;">System Synchronized</span>
            <span class="heart-glow">â¤</span>
        </div>
        <div style="text-align: left; font-size: 13px; line-height: 1.8; color: #fff;">
            <p style="color: var(--main-green); border-bottom: 1px solid var(--main-green); padding-bottom: 5px;">> [Message Decrypted]</p>
            äºç¿”ï¼Œç”Ÿæ—¥å¿«æ¨‚ğŸ°<br><br>
            æ­·å²æ•™æˆ‘å¾æ··äº‚ä¸­å°‹æ‰¾è¦å¾‹ï¼Œè€Œä½ æ•™æˆ‘å¾è¨Šè™Ÿä¸­çœ‹è¦‹ç©©å®šã€‚<br><br>
            å°±åƒ PLLï¼Œå³ä¾¿å¤–ç•Œå……æ»¿ Phase Noiseï¼Œåªè¦æˆ‘å€‘é »ç‡ä¸€è‡´ï¼Œå°±èƒ½ç¶­æŒæœ€å®Œç¾çš„ Phase Lockã€‚<br><br>
            é¡˜ä½ çš„ Vcore æ°¸é ç©©å®šï¼Œäººç”Ÿçš„ Error éƒ½èƒ½ä¸€éµ Resetã€‚åœ¨æœªä¾†çš„ç·¨å¹´å²è£¡ï¼Œæˆ‘å€‘å§‹çµ‚æ˜¯å½¼æ­¤çš„æœ€ä½³åŒ¹é…ã€‚â¤ï¸
            <p style="text-align: right; color: #aaa; font-size: 10px; margin-top:10px;">â€” ä½ å°ˆå±¬çš„PLL Controller</p>
        </div>
        <button onclick="location.reload()" style="margin-top: 15px; width: 100%; border-color: var(--final-pink); color: var(--final-pink);">Re-Run System</button>
    </div>
</div>

<script>
let hp=1000, mp=100, isSyncing=false, resetLeft=2, f1=1, f2=1;

const screenEl = document.getElementById("screen");
const hpBar = document.getElementById("hp-bar");
const mpBar = document.getElementById("mp-bar");
const hpText = document.getElementById("hp-text");
const mpText = document.getElementById("mp-text");
const rcnt = document.getElementById("r-cnt");
const syncBtn = document.getElementById("btn-sync");
const finalBtn = document.getElementById("btn-final");
const osc = document.getElementById("oscilloscope");
const ctrl = document.getElementById("ctrl-box");
const finalScreen = document.getElementById("final-screen");
const container = document.getElementById("game-container");
const match = document.getElementById("match-pct");

const ctx = document.getElementById("scopeCanvas").getContext("2d");

function addLog(t){
    screenEl.innerHTML += `<br>> ${t}`;
    screenEl.scrollTop = screenEl.scrollHeight;
}

function action(t){
    if(Math.random()<0.15){mp-=10; addLog("[Surge] transient noise on rail.");}
    if(t==='kalman'){let d=Math.floor(Math.random()*40)+80; hp-=d; mp-=5; addLog("Loop filter suppressing phase noise.");}
    else if(t==='reset'){
        if(resetLeft<=0||mp<40){addLog("Reset denied."); return;}
        hp-=380; mp-=40; resetLeft--;
        rcnt.innerText=resetLeft;
        addLog("Force Re-lock.");
    }
    else if(t==='recap'){mp=Math.min(100,mp+35); addLog("Ripple reduced. Rail stabilized.");}
    else if(t==='overclock'){
        if(Math.random()<0.45){mp-=45; addLog("Overclock unstable. Phase noise increased.");}
        else{hp-=280; addLog("Loop gain boosted at high frequency.");}
    }
    updateUI();
}

function updateUI(){
    hp=Math.max(0,hp); mp=Math.max(0,mp);
    hpBar.style.width=(hp/10)+"%";
    hpText.innerText=Math.floor(hp/10)+"%";
    mpBar.style.width=mp+"%";
    mpText.innerText=mp+"/100";
    if(hp<=0&&!isSyncing){addLog("Noise suppressed. Ready for lock."); syncBtn.disabled=false;}
}

function startSync(){
    isSyncing=true;
    osc.style.display='block';
    ctrl.style.display='block';
    syncBtn.style.display='none';
    addLog("Entering Phase Detector Loop.");
    requestAnimationFrame(draw);
}

document.getElementById("freq1").oninput=e=>{
    f1=parseFloat(e.target.value);
    document.getElementById("val1").innerText=f1.toFixed(2);
    checkStatus();
};
document.getElementById("freq2").oninput=e=>{
    f2=parseFloat(e.target.value);
    document.getElementById("val2").innerText=f2.toFixed(2);
    checkStatus();
};

function checkStatus(){
    const isF1Exact = f1.toFixed(2)==="5.01";
    const isF2Exact = f2.toFixed(2)==="3.26";

    if(isF1Exact && isF2Exact){
        match.innerText="PHASE: LOCKED";
        finalBtn.style.display="block";
    }else{
        match.innerText=(isF1Exact||isF2Exact)?"SYNC: 50%":"SYNC: 0%";
        finalBtn.style.display="none";
    }
}

function draw(){
    if(!isSyncing) return;

    ctx.fillStyle="#001a00";
    ctx.fillRect(0,0,400,150);

    const t=Date.now()*0.005;
    const isF1Exact = f1.toFixed(2)==="5.01";
    const isF2Exact = f2.toFixed(2)==="3.26";

    if(isF1Exact && isF2Exact){
        ctx.strokeStyle="#ff00ff";
        ctx.lineWidth=3;
        ctx.beginPath();
        for(let a=0;a<=Math.PI*2;a+=0.05){
            let x=16*Math.pow(Math.sin(a),3);
            let y=-(13*Math.cos(a)-5*Math.cos(2*a)-2*Math.cos(3*a)-Math.cos(4*a));
            ctx.lineTo(200+x*4,75+y*4);
        }
        ctx.stroke();
    }else{
        ctx.strokeStyle=isF1Exact?"#00d4ff":"#004466";
        ctx.lineWidth=2;
        ctx.beginPath();
        for(let x=0;x<400;x+=2){
            ctx.lineTo(x,40+Math.sin(x*(f1/40)+t)*20);
        }
        ctx.stroke();

        ctx.strokeStyle=isF2Exact?"#ff00ff":"#006622";
        ctx.lineWidth=2;
        ctx.beginPath();
        for(let x=0;x<400;x+=2){
            ctx.lineTo(x,110+Math.sin(x*(f2/40)+t)*20);
        }
        ctx.stroke();
    }
    requestAnimationFrame(draw);
}

function summon(){
    if(prompt("Access Key:")==="1209"){
        Array.from(container.children).forEach(e=>{ if(e.id!=="final-screen") e.style.display="none";});
        finalScreen.style.display='block';
    }else alert("Invalid");
}
</script>
</body>
</html>